{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NoteTube</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" type="image/png" href="{% static 'images/NoteTube-logo.png' %}?v=3">

  <style>
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }
    @-webkit-keyframes rotate {
      from { -webkit-transform: rotate(0deg); }
      to   { -webkit-transform: rotate(360deg); }
    }

    .load {
      width: 72px;
      height: 72px;
      margin: 28px auto 0;
      border: solid 8px rgba(255,255,255,0.18);
      border-top-color: #6d28ff;
      border-right-color: transparent;
      border-bottom-color: transparent;
      border-radius: 9999px;

      -webkit-animation: rotate 1.0s linear infinite;
      animation: rotate 1.0s linear infinite;
    }
  </style>
</head>

<body class="min-h-screen bg-[#0b0b10] text-white font-sans antialiased overflow-x-hidden">

  <div class="pointer-events-none fixed inset-0 -z-10">
    <div class="absolute inset-0 bg-[radial-gradient(1200px_700px_at_80%_10%,rgba(109,40,255,0.30),transparent_60%),radial-gradient(900px_600px_at_20%_80%,rgba(58,130,255,0.18),transparent_60%),radial-gradient(900px_600px_at_10%_20%,rgba(210,60,255,0.12),transparent_60%),linear-gradient(180deg,#05050a_0%,#0b0b10_45%,#04040a_100%)]"></div>
    <div class="absolute inset-0 opacity-[0.06] bg-[radial-gradient(rgba(255,255,255,0.6)_1px,transparent_1px)] [background-size:28px_28px]"></div>
    <div class="absolute inset-0 bg-[radial-gradient(1000px_700px_at_50%_40%,transparent_45%,rgba(0,0,0,0.65)_95%)]"></div>
  </div>

  <nav class="sticky top-4 z-20">
    <div class="mx-auto max-w-6xl px-4">
      <div class="flex items-center justify-between rounded-2xl border border-white/15 bg-black/30 px-4 py-3 shadow-2xl backdrop-blur-xl">
        <div class="flex items-center gap-3">
          <div class="h-9 w-9 rounded-2xl bg-white/10 ring-1 ring-white/15 grid place-items-center overflow-hidden">
            <img src="{% static 'images/NoteTube-logo.png' %}?v=3" class="h-7 w-7" alt="NoteTube">
          </div>
          <h1 class="text-xl font-semibold tracking-tight">
            <a href="/" class="hover:opacity-90">NoteTube</a>
          </h1>
        </div>

        <div class="flex items-center gap-4 text-sm text-white/75">
          <a href="/saved-notes" class="hover:text-white transition-colors">Saved Notes</a>
          <div class="h-4 w-px bg-white/10"></div>
          <a href="logout" class="hover:text-white transition-colors">Logout</a>
        </div>
      </div>
    </div>
  </nav>

  <div class="mx-auto max-w-6xl px-4 py-10">
    <div class="max-w-3xl mx-auto rounded-[2rem] border border-white/15 bg-white/5 p-6 sm:p-8 shadow-2xl backdrop-blur-xl">

      <div>
        <h2 class="text-3xl font-semibold tracking-tight">Welcome to NoteTube</h2>
        <p class="mt-3 text-white/70 leading-relaxed">
          Generate high-quality notes from YouTube videos using artificial intelligence.
          Simply enter the link to the YouTube video below and let the AI create the content for you!
        </p>
      </div>

      <div class="mt-8">
        <!-- Tab Buttons -->
        <div class="flex gap-3 mb-6 border-b border-white/10">
          <button id="youtubeTab" class="tab-button pb-3 px-1 font-semibold text-white/90 border-b-2 border-[#6d28ff] transition-colors active-tab">
            YouTube Link
          </button>
          <button id="mp3Tab" class="tab-button pb-3 px-1 font-semibold text-white/50 border-b-2 border-transparent hover:text-white/70 transition-colors">
            Upload MP3
          </button>
        </div>

        <!-- YouTube Tab Content -->
        <div id="youtubeContent" class="tab-content">
          <h2 class="text-xl font-semibold mb-4 text-white/90">Enter YouTube Video Link</h2>
          <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
            <input id="youtubeLink" type="url" placeholder="Paste YouTube Link..." class="flex-grow w-full h-12 rounded-2xl bg-black/20 border border-white/15 px-4 text-white placeholder:text-white/35 focus:outline-none focus:ring-2 focus:ring-[#6d28ff]/60"/>
            <button id="generateBlogButton" class="h-12 shrink-0 rounded-2xl bg-[#6d28ff] px-6 font-semibold hover:opacity-90 transition-opacity whitespace-nowrap">
              Generate Notes
            </button>
          </div>
        </div>

        <!-- MP3 Tab Content -->
        <div id="mp3Content" class="tab-content hidden">
          <h2 class="text-xl font-semibold mb-4 text-white/90">Upload MP3 File</h2>
          <div class="flex flex-col gap-4">
            <div>
              <label for="mp3Title" class="block text-sm font-medium text-white/70 mb-2">Note Title</label>
              <input id="mp3Title" type="text" placeholder="Enter a title for your notes..." class="w-full h-12 rounded-2xl bg-black/20 border border-white/15 px-4 text-white placeholder:text-white/35 focus:outline-none focus:ring-2 focus:ring-[#6d28ff]/60"/>
            </div>
            <div>
              <label for="mp3File" class="block text-sm font-medium text-white/70 mb-2">Select MP3 File</label>
              <div class="relative">
                <input id="mp3File" type="file" accept=".mp3" class="hidden"/>
                <button id="mp3FileButton" class="w-full h-12 rounded-2xl bg-black/20 border border-white/15 px-4 text-white/70 hover:text-white hover:bg-black/30 transition-all text-left flex items-center justify-between">
                  <span id="mp3FileName" class="text-white/50">Choose MP3 file...</span>
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                  </svg>
                </button>
              </div>
            </div>
            <button id="generateMp3Button" class="h-12 rounded-2xl bg-[#6d28ff] px-6 font-semibold hover:opacity-90 transition-opacity">
              Generate Notes from MP3
            </button>
          </div>
        </div>

        <div style="display:none;" id="loading-circle" class="load"></div>

        <section class="mt-10">
          <h2 class="text-xl mb-4 font-semibold text-white/90">Generated AI Notes</h2>

          <div id="blogContent" class="whitespace-pre-wrap rounded-2xl border border-white/10 bg-black/20 p-5 text-white/80 space-y-4 min-h-[140px]">
            <p class="text-white/45 text-sm">Your notes will appear here.</p>
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    // Tab switching functionality
    document.getElementById('youtubeTab').addEventListener('click', () => {
      document.getElementById('youtubeContent').classList.remove('hidden');
      document.getElementById('mp3Content').classList.add('hidden');
      document.getElementById('youtubeTab').classList.add('border-[#6d28ff]', 'text-white/90');
      document.getElementById('youtubeTab').classList.remove('border-transparent', 'text-white/50');
      document.getElementById('mp3Tab').classList.add('border-transparent', 'text-white/50');
      document.getElementById('mp3Tab').classList.remove('border-[#6d28ff]', 'text-white/90');
    });

    document.getElementById('mp3Tab').addEventListener('click', () => {
      document.getElementById('youtubeContent').classList.add('hidden');
      document.getElementById('mp3Content').classList.remove('hidden');
      document.getElementById('mp3Tab').classList.add('border-[#6d28ff]', 'text-white/90');
      document.getElementById('mp3Tab').classList.remove('border-transparent', 'text-white/50');
      document.getElementById('youtubeTab').classList.add('border-transparent', 'text-white/50');
      document.getElementById('youtubeTab').classList.remove('border-[#6d28ff]', 'text-white/90');
    });

    // MP3 file input handler
    document.getElementById('mp3FileButton').addEventListener('click', () => {
      document.getElementById('mp3File').click();
    });

    document.getElementById('mp3File').addEventListener('change', (e) => {
      const fileName = e.target.files[0]?.name || 'Choose MP3 file...';
      document.getElementById('mp3FileName').textContent = fileName;
      document.getElementById('mp3FileName').classList.remove('text-white/50');
      document.getElementById('mp3FileName').classList.add('text-white');
    });

    // YouTube notes generation
    document.getElementById('generateBlogButton').addEventListener('click', async () => {
      const youtubeLink = document.getElementById('youtubeLink').value;
      const blogContent = document.getElementById('blogContent');

      if (youtubeLink) {
        document.getElementById('loading-circle').style.display = 'block';
        blogContent.innerHTML = '';

        const endpointUrl = '/generate-notes';

        try {
          const response = await fetch(endpointUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ link: youtubeLink })
          });

          const data = await response.json();

          if (data.error) {
            alert('Error: ' + data.error);
          } else {
            blogContent.innerHTML = data.content;
          }

        } catch (error) {
          console.error("Error occurred:", error);
          alert("Something went wrong. Please try again later.");
        }

        document.getElementById('loading-circle').style.display = 'none';
      } else {
        alert("Please enter a YouTube link.");
      }
    });

    // MP3 notes generation
    document.getElementById('generateMp3Button').addEventListener('click', async () => {
      const mp3File = document.getElementById('mp3File').files[0];
      const title = document.getElementById('mp3Title').value || 'Untitled Note';
      const blogContent = document.getElementById('blogContent');

      if (!mp3File) {
        alert("Please select an MP3 file.");
        return;
      }

      document.getElementById('loading-circle').style.display = 'block';
      blogContent.innerHTML = '';

      const formData = new FormData();
      formData.append('mp3_file', mp3File);
      formData.append('title', title);

      try {
        const response = await fetch('/mp3-to-notes', {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (data.error) {
          alert('Error: ' + data.error);
        } else {
          blogContent.innerHTML = data.content;
          document.getElementById('mp3File').value = '';
          document.getElementById('mp3FileName').textContent = 'Choose MP3 file...';
          document.getElementById('mp3FileName').classList.add('text-white/50');
          document.getElementById('mp3FileName').classList.remove('text-white');
          document.getElementById('mp3Title').value = '';
        }

      } catch (error) {
        console.error("Error occurred:", error);
        alert("Something went wrong. Please try again later.");
      }

      document.getElementById('loading-circle').style.display = 'none';
    });
  </script>

</body>
</html>
